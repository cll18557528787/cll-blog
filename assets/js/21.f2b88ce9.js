(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{607:function(s,t,n){"use strict";n.r(t);var e=n(4),a=Object(e.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("blockquote",[n("p",[s._v("夯实基础，方能手到擒来")])]),s._v(" "),n("h2",{attrs:{id:"分析一下实现promise需要哪些逻辑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分析一下实现promise需要哪些逻辑"}},[s._v("#")]),s._v(" 分析一下实现Promise需要哪些逻辑")]),s._v(" "),n("ul",[n("li",[s._v("Promise有三种状态，pending(进行中)、fulfilled(已完成)、reject(已失败)，外界无法改变其状态，且一旦状态改变就不会再变了")]),s._v(" "),n("li",[s._v("实例化一个 Promise 需要传入一个 executor 函数 ，业务代码在 executor 函数中执行，另外 executor 函数接收两个参数 resolve 和 reject。resolve 和 reject 是 Promise 构造函数的内置函数")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("new Promise((resolve,reject)=>{\n\t// do something\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("在 executor 函数中业务代码执行成功了，调用 resolve 函数，把 Promise 的状态变为已成功，另外通过参数把业务代码的执行成功的结果传递到 Promise 中")]),s._v(" "),n("li",[s._v("在 executor 函数中业务代码执行失败了，调用 reject 函数，把 Promise 的状态变为已失败，另外通过参数把业务代码的执行失败的原因传递到 Promise 中")]),s._v(" "),n("li",[s._v("实例方法 then 的第一个参数是业务代码执行成功的回调函数，第二个参数是业务代码执行失败的回调函数，当业务代码执行完毕后，会根据执行结果调用对应的回调函数，且这些回调函数接收业务代码的执行结果作为参数")]),s._v(" "),n("li",[s._v("then方法可以链式调用，具有穿透性")]),s._v(" "),n("li",[s._v("实例方法 catch 来添加业务代码执行失败的回调函数")])]),s._v(" "),n("p",[s._v("那么下面就一一来实现 Promise 的功能")]),s._v(" "),n("h2",{attrs:{id:"初步搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初步搭建"}},[s._v("#")]),s._v(" 初步搭建")]),s._v(" "),n("p",[s._v("根据分析，首先我们需要完成这些功能：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("Promise 构造函数接收 executor 函数作为参数，且在其中执行 executor 函数")])]),s._v(" "),n("li",[n("p",[s._v("Promise 构造函数中有 resolve 和 reject 内置方法，并作为参数传递给 executor 函数")])]),s._v(" "),n("li",[n("p",[s._v("设置个实例属性 status 来存储状态")])]),s._v(" "),n("li",[n("p",[s._v("内置函数 resolve 可以把状态变为已成功，内置函数 reject 可以把状态变为已失败，且一旦状态改变就不会再变")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 这里使用了Symbol是为了防止外界其他原因改变了状态\nconst Pending = Symbol('Pending');\nconst Fulfilled = Symbol('Fulfilled');\nconst Rejected= Symbol('Rejected');\n\nfunction Promise(excutor){\n\t// 初始状态为pending\n\tthis.status = Pending;\n\tconst resolve = () => {  // 这里为了this的指向，使用了箭头函数，如果不用箭头函数，需要用变量存一下this\n\t\tif(this.status === Pending){  // 只有在状态为pending时才可以发生改变\n\t\t\tthis.status = Fulfilled;\n\t\t}\n\t};\n\tconst reject = () => {\n\t\tif(this.status === Pending){  // 只有在状态为pending时才可以发生改变\n\t\t\tthis.status = Rejected;\n\t\t}\n\t};\n\texcutor(resolve,reject);\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h2",{attrs:{id:"初步实现then方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初步实现then方法"}},[s._v("#")]),s._v(" 初步实现then方法")]),s._v(" "),n("p",[s._v("按照上面对 then 实例方法的业务场景的简单分析，在 then 实例方法中调用回调函数时，还要把 executor 函数中业务代码的执行结果作为参数传递进去，那么要新增实例属性来存储业务代码的执行结果。另外执行成功的结果通过内置方法 resolve 的参数传入，其执行失败的原因通过内置方法 reject 的参数传入")]),s._v(" "),n("p",[s._v("因为then方法是实例可调用的，所以then方法是在构造函数原型上的：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 这里使用了Symbol是为了防止外界其他原因改变了状态\nconst Pending = Symbol('Pending');\nconst Fulfilled = Symbol('Fulfilled');\nconst Rejected= Symbol('Rejected');\n\nfunction Promise(excutor){\n\t// 初始状态为pending\n\tthis.status = Pending;\n\tthis.value = undefined;\n\tthis.error = undefined;\n\tconst resolve = value => {  // 这里为了this的指向，使用了箭头函数，如果不用箭头函数，需要用变量存一下this\n\t\tif(this.status === Pending){  // 只有在状态为pending时才可以发生改变\n\t\t\tthis.status = Fulfilled;\n\t\t\tthis.value = value;\n\t\t}\n\t};\n\tconst reject = value => {\n\t\tif(this.status === Pending){  // 只有在状态为pending时才可以发生改变\n\t\t\tthis.status = Rejected;\n\t\t\tthis.error = value;\n\t\t}\n\t};\n\texcutor(resolve,reject);\n};\n\nPromise.prototype.then = function(resolveCallback,rejectCallback){  // 这里为什么不用箭头函数，注意this指向\n\tif(this.status === Fulfilled){\n\t\tif(resolveCallback && typeof resolveCallback === 'function'){\n\t\t\tresolveCallback(this.value);\n\t\t}\n\t}\n\tif(this.status === Rejected){\n\t\tif(rejectCallback && typeof rejectCallback === 'function'){\n\t\t\trejectCallback(this.error);\n\t\t}\n\t}\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("p",[s._v("初步实现了then方法，那么我来验证一下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const promise = new Promise((resolve,reject)=>{\n\tresolve('执行成功');\n});\n\npromise.then(res=>{\n\tconsole.log(res);\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/537484fd0e174ab2acd30afb87b03ca4~tplv-k3u1fbpfcp-zoom-1.image",alt:"控制台打印结果"}}),s._v("\n控制台能打印出我们想要的结果，说明到目前为止，我们写的都没问题，但是接下来我们思考，如果我们的excutor是个执行异步方法的函数呢：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const promise = new Promise((resolve,reject)=>{\n\tsetTimeout(()=>{\n\t\tresolve('执行成功');\n\t},2000);\n});\n\npromise.then(res=>{\n\tconsole.log(res);\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("结果可以发现，2秒后并没有打印出我们想要的结果，因为调用 then 实例方法时，Promise 的状态是 Pending ，虽然2秒后 Promise 的状态变为 Fulfilled ，但是 then 实例方法已经调用过了")]),s._v(" "),n("p",[s._v("那么要怎么控制 then 实例方法中回调函数的执行时机。可以用发布订阅者的设计模式来实现。")]),s._v(" "),n("p",[s._v("当调用 then 实例方法时，如果 Promise 的状态是 Pending 时，先将成功回调函数和失败回调函数分别存放起来，在 executor 函数中异步任务执行结束，触发内置方法 resolve 或 reject，在其中去依次调用这些回调函数。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const Pending = Symbol('Pending');\nconst Fulfilled = Symbol('Fulfilled');\nconst Rejected= Symbol('Rejected');\n\nfunction Promise(excutor){\n\tthis.status = Pending;\n\tthis.value = undefined;\n\tthis.error = undefined;\n\tthis.onFulfilled = [];  //这里用数组来存放resolve时的回调\n\tthis.onRejected = []; //这里用数组来存放reject时的回调\n\tconst resolve = value => {\n\t\tif(this.status === Pending){\n\t\t\tthis.status = Fulfilled;\n\t\t\tthis.value = value;\n\t\t\tthis.onFulfilled.forEach(fn => fn());\n\t\t}\n\t};\n\tconst reject = value => {\n\t\tif(this.status === Pending){\n\t\t\tthis.status = Rejected;\n\t\t\tthis.error = value;\n\t\t\tthis.onRejected.forEach(fn => fn());\n\t\t}\n\t};\n\texcutor(resolve,reject);\n};\n\nPromise.prototype.then = function(resolveCallback,rejectCallback){\n\tif(this.status === Fulfilled){\n\t\tif(resolveCallback && typeof resolveCallback === 'function'){\n\t\t\tresolveCallback(this.value);\n\t\t}\n\t}\n\tif(this.status === Rejected){\n\t\tif(rejectCallback && typeof rejectCallback === 'function'){\n\t\t\trejectCallback(this.error);\n\t\t}\n\t}\n\t//如果调用then方法的时候，状态还是pending，就先将回调保存起来\n\tif(this.status === Pending){\n\t\tif(resolveCallback && typeof resolveCallback === 'function'){\n\t\t\tthis.onFulfilled.push(()=>{\n\t\t\t\tresolveCallback(this.value);\n\t\t\t});\n\t\t}\n\t\tif(rejectCallback && typeof rejectCallback === 'function'){\n\t\t\tthis.onRejected.push(()=>{\n\t\t\t\trejectCallback(this.error)\n\t\t\t});\n\t\t}\n\t}\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br")])]),n("p",[s._v("再进行实例化验证一下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const promise = new Promise((resolve,reject)=>{\n\tsetTimeout(()=>{\n\t\tresolve('执行成功');\n\t},2000);\n});\n\npromise.then(res=>{\n\tconsole.log(res);\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("结果控制台在2秒后能够成功打印出“执行成功”，说明目前我们的逻辑都正确，再测试一下reject的情况：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const promise = new Promise((resolve,reject)=>{\n\tsetTimeout(()=>{\n\t\treject('执行失败');\n\t},2000);\n});\n\npromise.then(res=>{\n\t// do nothing\n},err=>{\n\tconsole.log(err)\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("控制台在2秒后能够成功打印出“执行失败”")]),s._v(" "),n("h2",{attrs:{id:"then方法的微任务机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#then方法的微任务机制"}},[s._v("#")]),s._v(" then方法的微任务机制")]),s._v(" "),n("p",[s._v("由于原生的 Promise 是V8引擎提供的微任务，我们无法还原V8引擎的实现，所以这里使用 setTimeout 模拟异步，所以原生的是微任务，这里是宏任务代替（如果你想实现 promise 的微任务，可以 mutationObserver 替代 seiTimeout 来实现微任务。这里只是模拟异步而已）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Promise.prototype.then = function(resolveCallback,rejectCallback){  \n\tif(this.status === Fulfilled){\n\t\tif(resolveCallback && typeof resolveCallback === 'function'){\n\t\t\t// 用setTimeout代替微任务\n\t\t\tsetTimeout(()=>{\n\t\t\t\tresolveCallback(this.value);\n\t\t\t},0);\n\t\t}\n\t}\n\tif(this.status === Rejected){\n\t\tif(rejectCallback && typeof rejectCallback === 'function'){\n\t\t\tsetTimeout(()=>{\n\t\t\t\trejectCallback(this.error);\n\t\t\t},0);\n\t\t}\n\t}\n\tif(this.status === Pending){\n\t\tif(resolveCallback && typeof resolveCallback === 'function'){\n\t\t\tthis.onFulfilled.push(()=>{\n\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\tresolveCallback(this.value);\n\t\t\t\t},0);\n\t\t\t});\n\t\t}\n\t\tif(rejectCallback && typeof rejectCallback === 'function'){\n\t\t\tthis.onRejected.push(()=>{\n\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\trejectCallback(this.error);\n\t\t\t\t},0);\n\t\t\t});\n\t\t}\n\t}\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("h2",{attrs:{id:"then的链式调用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#then的链式调用"}},[s._v("#")]),s._v(" then的链式调用")]),s._v(" "),n("p",[s._v("实例方法 then 链式调用有两个要求：")]),s._v(" "),n("ul",[n("li",[s._v("在实例方法 then 后面可以直接使用实例方法 then")]),s._v(" "),n("li",[s._v("在前面一个实例方法 then 返回一个值，不管是什么值，在后面一个实例方法 then 中都能获取到")])]),s._v(" "),n("p",[s._v("既然要能链式调用，那么then中返回的肯定也是一个promise，把实例方法 then 返回的值 value，通过 resolve(value) 或 reject(value) 传递出去")]),s._v(" "),n("p",[s._v("当然我们还需要一个专门处理then的函数，用来解决对实例方法then返回的值的类型做判断和对应处理：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Promise.prototype.then = function(resolveCallback,rejectCallback){\n\tlet promise = new Promise((resolve,reject)=>{\n\t\tif(this.status === Fulfilled){\n\t\t\tif(resolveCallback && typeof resolveCallback === 'function'){\n\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\tlet x = resolveCallback(this.value);\n\t\t\t\t\thandleValue(promise,x,resolve,reject);   // 这里用工具函数处理\n\t\t\t\t},0);\n\t\t\t}\n\t\t}\n\t\tif(this.status === Rejected){\n\t\t\tif(rejectCallback && typeof rejectCallback === 'function'){\n\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\tlet x = rejectCallback(this.error);\n\t\t\t\t\thandleValue(promise,x,resolve,reject);\n\t\t\t\t},0);\n\t\t\t}\n\t\t}\n\t\tif(this.status === Pending){\n\t\t\tif(resolveCallback && typeof resolveCallback === 'function'){\n\t\t\t\tthis.onFulfilled.push(()=>{\n\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\tlet x = resolveCallback(this.value);\n\t\t\t\t\t\thandleValue(promise,x,resolve,reject);\n\t\t\t\t\t},0);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(rejectCallback && typeof rejectCallback === 'function'){\n\t\t\t\tthis.onRejected.push(()=>{\n\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\tlet x = rejectCallback(this.error);\n\t\t\t\t\t\thandleValue(promise,x,resolve,reject);\n\t\t\t\t\t},0);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t})\n\treturn promise\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("p",[s._v("然后写一下这个handleValue工具函数：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const handleValue = (promise,x,resolve,reject)=>{\n\t// 如果自己循环调用自己\n\tif(promise === x){\n\t\treturn reject(new TypeError('链式循环调用了'));\n\t}\n\tlet once = false;   // 确保只传递出去一次值\n\tif(typeof x === 'object' && x !== null || typeof x === 'function'){\n\t\tconst then = x.then;\n\t\t// 判断x是不是Promise\n\t\tif(then && typeof then === 'function'){\n\t\t\t//调用then实例方法处理Promise执行结果\n\t\t\tthen.call(x,y=>{\n\t\t\t\tif(once) return\n\t\t\t\tonce = true;  // 防止Promise中Promise执行成功后又传递一个Promise过来，\n\t\t\t\thandleValue(promise,y,resolve,reject);   // 递归解析\n\t\t\t},r=>{\n\t\t\t\tif(once) return\n\t\t\t\tonce = true;\n\t\t\t\treject(r);\n\t\t\t})\n\t\t}else{\n\t\t\t// 如果x是个普通对象，直接调用resolve(x)\n\t\t\tresolve(x);\n\t\t}\n\t}else{\n\t\t// 如果x是个原始值，直接调用resolve(x)\n\t\tresolve(x);\n\t}\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("在上述代码中，判断typeof then === 'function'时其实是在判断返回的 x 是否为一个 Promise。如果没有 then 函数，x 即为普通值，直接返回 resolve(x)。如果有 then 函数，x 即为一个 Promise，就递归解析这个 Promise，直到 x 是一个普通值后作为最后的结果返回")]),s._v(" "),n("p",[s._v("那么为什么用typeof then === 'function' 判断 x 是否为一个 Promise ，而不是用 x instanceof Promise 。 这是为了让 Promise 更具有通用性，所以一个 thenable 对象也可以看做是一个 Promise 。 thenable 对象就是一个拥有 then 方法的对象，如下代码所示例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("let thenable = {\n    then: function(resolve, reject){\n    \tresolve('执行成功')\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("在 thenable.then 方法中通过 resolve 传递执行成功的结果。但是 thenable 对象不是通过 Promise 类 new 出来的，故不能通过 x instanceof Promise 来判断是不是一个 Promise")]),s._v(" "),n("h2",{attrs:{id:"then的穿透"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#then的穿透"}},[s._v("#")]),s._v(" then的穿透")]),s._v(" "),n("p",[s._v("如果要实现如下的逻辑呢？")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const p = new Promise((resolve, reject) => {\n    setTimeout(() => {\n        resolve('\"执行成功\"')\n    }, 2000)\n\n})\np.then().then(res =>{\n    console.log(res)\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("此时的then方法是需要具备穿透性的，后面的实例方法 then 依旧可以得到之前实例方法 then 返回的值，我们再来修改一下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Promise.prototype.then = function(resolveCallback,rejectCallback){\n\tresolveCallback = typeof resolveCallback === 'function' ? resolveCallback : v => v;\n\trejectCallback = typeof rejectCallback ===  'function'  ? rejectCallback : err => {\n\t\tthrow err\n\t};\n\tlet promise = new Promise((resolve,reject)=>{\n\t\tif(this.status === Fulfilled){\n\t\t\tif(resolveCallback && typeof resolveCallback === 'function'){\n\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\tlet x = resolveCallback(this.value);\n\t\t\t\t\thandleValue(promise,x,resolve,reject); \n\t\t\t\t},0);\n\t\t\t}\n\t\t}\n\t\tif(this.status === Rejected){\n\t\t\tif(rejectCallback && typeof rejectCallback === 'function'){\n\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\tlet x = rejectCallback(this.error);\n\t\t\t\t\thandleValue(promise,x,resolve,reject);\n\t\t\t\t},0);\n\t\t\t}\n\t\t}\n\t\tif(this.status === Pending){\n\t\t\tif(resolveCallback && typeof resolveCallback === 'function'){\n\t\t\t\tthis.onFulfilled.push(()=>{\n\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\tlet x = resolveCallback(this.value);\n\t\t\t\t\t\thandleValue(promise,x,resolve,reject);\n\t\t\t\t\t},0);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(rejectCallback && typeof rejectCallback === 'function'){\n\t\t\t\tthis.onRejected.push(()=>{\n\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\tlet x = rejectCallback(this.error);\n\t\t\t\t\t\thandleValue(promise,x,resolve,reject);\n\t\t\t\t\t},0);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t})\n\treturn promise\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br")])]),n("h2",{attrs:{id:"catch方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#catch方法"}},[s._v("#")]),s._v(" catch方法")]),s._v(" "),n("p",[s._v("catch其实就是 then(null, rejectCallback)的别名")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Promise.prototype.catch =  function(rejectCallback){\n\tthis.then(null,rejectCallback);\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"优化完整代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优化完整代码"}},[s._v("#")]),s._v(" 优化完整代码")]),s._v(" "),n("p",[s._v("处理一下内部错误等")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const Fulfilled = Symbol('Fulfilled')\nconst Rejected = Symbol('Rejected')\nconst Pending = Symbol('Pending')\n\nconst handleValue = (promise,x,resolve,reject) => {\n  if(promise === x){\n    return reject(new TypeError('检测到循环调用'))\n  }\n  let once = false\n  if(typeof x === 'object' && x !== null || typeof x === 'function'){\n    const then = x.then\n    if(typeof then === 'function'){\n      then.call(x,y=>{\n        if(once) return\n        once = true\n        handleValue(promise,y,resolve,reject)\n      },r=>{\n        if(once) return\n        once = true\n        reject(r)\n      })\n    }else{\n      resolve(x)\n    }\n  }else{\n    resolve(x)\n  }\n}\n\nfunction Promise(excutor){\n  this.status = Pending\n  this.value = undefined\n  this.reason = undefined\n  this.onFulfilled = []\n  this.onRejected = []\n\n  const resolve = value => {\n    if(this.status === Pending){\n      this.status = Fulfilled\n      this.value = value\n      this.onFulfilled.forEach(fn => {\n        if(typeof fn === 'function'){\n          fn()\n        }\n      })\n    }\n  }\n\n  const reject = value => {\n    if(this.status === Pending){\n      this.status = Rejected\n      this.reason = value\n      this.onRejected.forEach(fn => {\n        if(typeof fn === 'function'){\n          fn()\n        }\n      })\n    }\n  }\n\n  try{\n    excutor(resolve,reject)\n  }\n  catch(err){\n    reject(err)\n  }\n}\n\nPromise.prototype.then = function(fulfilledCallback,rejectedCallback){\n  fulfilledCallback = typeof fulfilledCallback === 'function' ? fulfilledCallback : v => v\n  rejectedCallback = typeof rejectedCallback === 'function' ? rejectedCallback : err => {\n    throw err\n  }\n  let promise = new Promise((resolve,reject)=>{\n    if(this.status === Pending){\n      if(fulfilledCallback && typeof fulfilledCallback === 'function'){\n        this.onFulfilled.push(()=>{\n          setTimeout(()=>{\n            try{\n              let x = fulfilledCallback(this.value)\n              handleValue(promise,x,resolve,reject)\n            }catch(err){\n              reject(err)\n            }\n          },0)\n        })\n      }\n      if(rejectedCallback && typeof rejectedCallback === 'function'){\n        this.onRejected.push(()=>{\n          setTimeout(()=>{\n            try{\n              let x = rejectedCallback(this.reason)\n              handleValue(promise,x,resolve,reject)\n            }catch(err){\n              reject(err)\n            }\n          })\n        })\n      }\n    }\n\n    if(this.status === Fulfilled){\n      if(fulfilledCallback && typeof fulfilledCallback === 'function'){\n        setTimeout(()=>{\n          try{\n            let x = fulfilledCallback(this.value)\n            handleValue(promise,x,resolve,reject)\n          }catch(err){\n            reject(err)\n          }\n        },0)\n      }\n    }\n\n    if(this.status === Rejected){\n      if(rejectedCallback && typeof rejectedCallback === 'function'){\n        setTimeout(()=>{\n          try{\n            let x = rejectedCallback(this.reason)\n            handleValue(promise,x,resolve,reject)\n          }catch(err){\n            reject(err)\n          }\n        })\n      }\n    }\n  }) \n  return promise\n}\n\nPromise.prototype.catch = function(rejectCallback){\n  this.then(null,rejectCallback)\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br")])]),n("p",[s._v("那么对Promise和他的实例方法then和catch的解析，我们就到这了，接下来我们会对他的静态方法再做具体的分析")])])}),[],!1,null,null,null);t.default=a.exports}}]);